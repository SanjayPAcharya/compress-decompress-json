<div class="container">
  <h1>
    <span style="color: #00796b">Compression - Decompression</span> Utility
  </h1>

  <!-- START: FIX FOR MESSAGE JUMP -->
  <div class="message-area-fixed">
    <div
      class="message error"
      [class.visible]="errorMessage"
      *ngIf="errorMessage"
    >
      {{ errorMessage }}
    </div>

    <div
      class="message status"
      [class.visible]="!errorMessage && statusMessage && !isLoading"
      *ngIf="!errorMessage && statusMessage && !isLoading"
      [innerHTML]="statusMessage"
    ></div>
  </div>
  <!-- END: FIX FOR MESSAGE JUMP -->

  <!-- Main Content: Side-by-Side View -->
  <div class="main-content">
    <!-- LEFT COLUMN: Input and Controls -->
    <div class="input-container">
      <div
        class="input-section"
        [class.drag-over]="isDragging"
        (dragleave)="onDragLeave($event)"
        (drop)="onDrop($event)"
        (dragover)="onDragOver($event)"
      >
        <h3>1. Input (Paste or Upload)</h3>

        <textarea
          [(ngModel)]="dataInput"
          (ngModelChange)="onDataChange()"
          rows="15"
          placeholder="Paste your JSON object or compressed string here..."
          [disabled]="isLoading"
        ></textarea>

        <div class="file-action-area">
          <button
            (click)="fileInput.click()"
            class="upload-btn"
            [disabled]="isLoading"
          >
            Select File
          </button>
          <p class="file-area-text">
            Or **Drag and drop** a text/json file onto this area.
          </p>
        </div>

        <input
          type="file"
          #fileInput
          (change)="handleFileInputChange($event)"
          style="display: none"
          accept=".txt,.json"
        />
      </div>

      <!-- Worker Toggle and Action Bar -->
      <div class="processing-options">
        <label class="toggle-switch">
          <input
            type="checkbox"
            [(ngModel)]="useWebWorker"
            (change)="onWorkerToggle()"
            [disabled]="isLoading"
          />
          <span class="slider round"></span>
        </label>
        <span class="toggle-label">
          Use Web Worker (Async, Recommended for >1MB)
        </span>
      </div>

      <div class="action-bar">
        <button
          (click)="handleAction()"
          [disabled]="
            dataType === 'unknown' || dataInput.trim().length === 0 || isLoading
          "
          [ngClass]="{
            'compress-btn': dataType === 'json',
            'decompress-btn': dataType === 'compressed'
          }"
        >
          <span *ngIf="!isLoading">
            {{
              dataType === "json"
                ? "Compress Data"
                : dataType === "compressed"
                ? "Decompress Data"
                : "Analyze Data"
            }}
          </span>
          <span *ngIf="isLoading"> Processing... </span>
        </button>

        <p *ngIf="originalSize > 0" class="size-info">
          Input Size: **{{ originalSize }} bytes**
        </p>
      </div>
    </div>

    <!-- RIGHT COLUMN: Result -->
    <div class="result-container">
      <h3>
        2. Result:
        {{ resultTitle || (isLoading ? "Processing..." : "Awaiting Action") }}
      </h3>

      <div class="result-box">
        <div *ngIf="isLoading" class="loading-overlay">
          <div class="spinner"></div>
          <p>Handling large data, please wait...</p>
        </div>

        <textarea
          [value]="resultData"
          rows="15"
          readonly
          [ngClass]="{ 'hidden-textarea': isLoading }"
        ></textarea>
      </div>

      <div class="result-actions" *ngIf="resultData && !isLoading">
        <div class="result-buttons">
          <button (click)="copyToClipboard()">Copy to Clipboard</button>
          <button (click)="downloadFile()">Download as File</button>
        </div>

        <p class="size-info right">
          <span>Output Size: **{{ resultSize }} bytes**</span>
          <span *ngIf="dataType === 'json' && originalSize > 0" class="ratio">
            ({{ compressionRatio }})
          </span>
        </p>
      </div>
    </div>
  </div>
</div>
